<!-- /templates/cv_edit.html -->
{% extends "base.html" %}

{% block title %}Xây dựng CV: {{ cv.title }}{% endblock %}

{% block content %}
<div class="cv-editor-container">

    <!-- CỘT 1: THANH CÔNG CỤ (SIDEBAR) -->
    <aside class="editor-sidebar">
        <!-- Main Navigation -->
        <nav class="sidebar-main-nav">
            <a href="{{ url_for('candidate.manage_cvs') }}" class="nav-back" title="Quản lý CV"><i class="fas fa-arrow-left"></i></a>
            <button class="nav-tab active" data-panel="content-panel" title="Nội dung"><i class="fas fa-file-alt"></i></button>
            <button class="nav-tab" data-panel="design-panel" title="Thiết kế"><i class="fas fa-palette"></i></button>
            <button class="nav-tab" data-panel="layout-panel" title="Bố cục"><i class="fas fa-th-large"></i></button>
        </nav>

        <!-- Panels (sẽ được hiển thị/ẩn bởi JS) -->
        <div class="sidebar-panels">
            <!-- Panel Nội dung -->
            <div id="content-panel" class="sidebar-panel active">
                <div class="panel-header">
                    <!-- SỬA LẠI ĐÂY: Thêm id="form-panel-title" -->
                    <h4 id="form-panel-title">Nội dung CV</h4>
                </div>
                <!-- SỬA LẠI ĐÂY: Đổi tên id cho đúng -->
                <div id="content-form-container" class="panel-body">
                    <!-- Form chỉnh sửa chi tiết sẽ được JS render vào đây -->
                </div>
            </div>
            <!-- Panel Thiết kế -->
            <div id="design-panel" class="sidebar-panel">
                <div class="panel-header"><h4>Thiết kế & Font</h4></div>
                <div class="panel-body">
                    <div class="form-group"><label>FONT CHỮ</label><select id="font-family-select" class="form-control"><option value="'Roboto', sans-serif">Roboto</option><option value="'Arial', sans-serif">Arial</option><option value="'Times New Roman', serif">Times New Roman</option></select></div>
                    <div class="form-group"><label>MÀU CHỦ ĐỀ</label><input type="color" id="theme-color" class="form-control"></div>
                </div>
            </div>
            <!-- Panel Bố cục (Layout) -->
            <div id="layout-panel" class="sidebar-panel">
                 <div class="panel-header"><h4>Bố cục</h4></div>
                 <div class="panel-body"><p>Tính năng sắp ra mắt.</p></div>
            </div>
        </div>
    </aside>

    <!-- CỘT 2: KHÔNG GIAN LÀM VIỆC (CV PREVIEW) -->
    <main class="editor-workspace">
        <div class="workspace-header">
            <!-- SỬA LẠI ĐÂY: Thêm id="save-status" -->
            <span id="save-status"></span>
            <div class="workspace-actions">
                <a href="{{ url_for('candidate.preview_cv', cv_id=cv.id) }}" target="_blank" class="btn btn-secondary">Xem trước</a>
                <!-- SỬA LẠI ĐÂY: Thêm id="btn-download-pdf" -->
                <button id="btn-download-pdf" class="btn btn-primary">Lưu & Tải xuống</button>
            </div>
        </div>
        <div class="workspace-sheet-wrapper">
            <!-- SỬA LẠI ĐÂY: Thêm id="cv-sheet" -->
            <div id="cv-sheet" class="cv-preview-sheet">
                <!-- CV "live" sẽ được JS render vào đây -->
            </div>
        </div>
    </main>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
<script src="{{ url_for('static', filename='js/cv_editor.js') }}"></script>
{% endblock %}